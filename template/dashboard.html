<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Monitor Dashboard - {{ user.username }}</title>
    <link rel="stylesheet" href="assets/css/app.min.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/custom.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .event-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-left: 4px solid #007bff;
        }
        .event-card.warning { border-left-color: #ffc107; }
        .event-card.error { border-left-color: #dc3545; }
        .event-card.success { border-left-color: #28a745; }
        .user-welcome {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="main-wrapper">
            <!-- Sidebar -->
            <div class="navbar-bg"></div>
            <nav class="navbar navbar-expand-lg main-navbar">
                <a href="/" class="navbar-brand sidebar-gone-hide">App Monitor</a>
                <div class="navbar-nav navbar-right ml-auto">
                    <div class="dropdown">
                        <a href="#" data-toggle="dropdown" class="nav-link dropdown-toggle nav-link-lg nav-link-user">
                            <img alt="image" src="assets/img/user.png" class="rounded-circle mr-1">
                            <div class="d-sm-none d-lg-inline-block">Hi, {{ user.first_name or user.username }}</div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a href="/profile" class="dropdown-item has-icon">
                                <i class="far fa-user"></i> Profile
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="/logout" class="dropdown-item has-icon text-danger">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- Main Content -->
            <div class="main-content">
                <section class="section">
                    <div class="section-header">
                        <h1>Dashboard</h1>
                    </div>

                    <!-- User Welcome -->
                    <div class="user-welcome">
                        <h2>Welcome back, {{ user.first_name or user.username }}!</h2>
                        <p>Here's what's happening with your applications today.</p>
                        <small>Last login: {{ user.last_login.strftime('%Y-%m-%d %H:%M:%S') if user.last_login else 'Never' }}</small>
                    </div>

                    <div class="row">
                        <!-- Recent Metrics -->
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header">
                                    <h4>Recent Metrics</h4>
                                </div>
                                <div class="card-body">
                                    {% if metrics %}
                                        {% for metric in metrics %}
                                        <div class="metric-card">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h5 class="mb-1">{{ metric.metric_name.replace('_', ' ').title() }}</h5>
                                                    <p class="mb-0">{{ metric.metric_value }} {{ metric.metric_unit }}</p>
                                                </div>
                                                <div class="text-right">
                                                    <small>{{ metric.metric_type.title() }}</small><br>
                                                    <small>{{ metric.timestamp.strftime('%H:%M:%S') }}</small>
                                                </div>
                                            </div>
                                            {% if metric.tags %}
                                            <div class="mt-2">
                                                {% for key, value in metric.tags.items() %}
                                                <span class="badge badge-light mr-1">{{ key }}: {{ value }}</span>
                                                {% endfor %}
                                            </div>
                                            {% endif %}
                                        </div>
                                        {% endfor %}
                                    {% else %}
                                        <p class="text-muted">No metrics available yet.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Recent Events -->
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <h4>System Events</h4>
                                </div>
                                <div class="card-body">
                                    {% if events %}
                                        {% for event in events %}
                                        <div class="event-card {{ event.event_level }}">
                                            <h6 class="mb-1">{{ event.event_type.replace('_', ' ').title() }}</h6>
                                            <p class="mb-1">{{ event.event_message }}</p>
                                            <small class="text-muted">
                                                {{ event.timestamp.strftime('%H:%M:%S') }} â€¢ {{ event.source }}
                                            </small>
                                        </div>
                                        {% endfor %}
                                    {% else %}
                                        <p class="text-muted">No events available yet.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4>Quick Actions</h4>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <a href="/api/metrics" class="btn btn-primary btn-block">
                                                <i class="fas fa-chart-line"></i> View All Metrics
                                            </a>
                                        </div>
                                        <div class="col-md-3">
                                            <a href="/api/events" class="btn btn-info btn-block">
                                                <i class="fas fa-list"></i> View All Events
                                            </a>
                                        </div>
                                        <div class="col-md-3">
                                            <a href="/profile" class="btn btn-success btn-block">
                                                <i class="fas fa-user-cog"></i> User Settings
                                            </a>
                                        </div>
                                        <div class="col-md-3">
                                            <a href="/pages" class="btn btn-secondary btn-block">
                                                <i class="fas fa-sitemap"></i> Browse Pages
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/app.min.js"></script>
    <script src="assets/js/scripts.js"></script>
    <script>
        // Load user preferences
        fetch('/api/preferences')
            .then(response => response.json())
            .then(prefs => {
                if (prefs.theme) {
                    document.body.setAttribute('data-theme', prefs.theme);
                }
                if (prefs.dashboard_layout) {
                    document.body.setAttribute('data-layout', prefs.dashboard_layout);
                }
            })
            .catch(error => console.error('Error loading preferences:', error));
    </script>
</body>
</html>
