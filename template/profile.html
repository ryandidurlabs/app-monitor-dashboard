<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile - {{ user.username }}</title>
    <link rel="stylesheet" href="assets/css/app.min.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/custom.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <div id="app">
        <div class="main-wrapper">
            <!-- Navbar -->
            <div class="navbar-bg"></div>
            <nav class="navbar navbar-expand-lg main-navbar">
                <a href="/" class="navbar-brand sidebar-gone-hide">App Monitor</a>
                <div class="navbar-nav navbar-right ml-auto">
                    <div class="dropdown">
                        <a href="#" data-toggle="dropdown" class="nav-link dropdown-toggle nav-link-lg nav-link-user">
                            <img alt="image" src="assets/img/user.png" class="rounded-circle mr-1">
                            <div class="d-sm-none d-lg-inline-block">Hi, {{ user.first_name or user.username }}</div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a href="/profile" class="dropdown-item has-icon">
                                <i class="far fa-user"></i> Profile
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="/logout" class="dropdown-item has-icon text-danger">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- Main Content -->
            <div class="main-content">
                <section class="section">
                    <div class="section-header">
                        <h1>User Profile</h1>
                        <div class="section-header-breadcrumb">
                            <div class="breadcrumb-item active"><a href="/">Dashboard</a></div>
                            <div class="breadcrumb-item">Profile</div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- User Info -->
                        <div class="col-lg-4">
                            <div class="card profile-widget">
                                <div class="profile-widget-header">
                                    <img alt="image" src="assets/img/user.png" class="rounded-circle profile-widget-picture">
                                    <div class="profile-widget-items">
                                        <div class="profile-widget-item">
                                            <div class="profile-widget-item-label">Admin</div>
                                            <div class="profile-widget-item-value">{{ "Yes" if user.is_admin else "No" }}</div>
                                        </div>
                                        <div class="profile-widget-item">
                                            <div class="profile-widget-item-label">Status</div>
                                            <div class="profile-widget-item-value">{{ "Active" if user.is_active else "Inactive" }}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="profile-widget-description">
                                    <div class="profile-widget-name">{{ user.first_name }} {{ user.last_name }}</div>
                                    <div class="profile-widget-desc">{{ user.email }}</div>
                                </div>
                                <div class="card-footer text-center">
                                    <div class="font-weight-bold mb-2">Member since</div>
                                    <div>{{ user.created_at.strftime('%B %Y') if user.created_at else 'Unknown' }}</div>
                                </div>
                            </div>
                        </div>

                        <!-- Preferences -->
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header">
                                    <h4>Dashboard Preferences</h4>
                                </div>
                                <div class="card-body">
                                    <form id="preferencesForm">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>Theme</label>
                                                    <select class="form-control" id="theme" name="theme">
                                                        <option value="light" {{ 'selected' if preferences and preferences.theme == 'light' else '' }}>Light</option>
                                                        <option value="dark" {{ 'selected' if preferences and preferences.theme == 'dark' else '' }}>Dark</option>
                                                        <option value="auto" {{ 'selected' if preferences and preferences.theme == 'auto' else '' }}>Auto</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>Dashboard Layout</label>
                                                    <select class="form-control" id="dashboard_layout" name="dashboard_layout">
                                                        <option value="default" {{ 'selected' if preferences and preferences.dashboard_layout == 'default' else '' }}>Default</option>
                                                        <option value="compact" {{ 'selected' if preferences and preferences.dashboard_layout == 'compact' else '' }}>Compact</option>
                                                        <option value="wide" {{ 'selected' if preferences and preferences.dashboard_layout == 'wide' else '' }}>Wide</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>Language</label>
                                                    <select class="form-control" id="language" name="language">
                                                        <option value="en" {{ 'selected' if preferences and preferences.language == 'en' else '' }}>English</option>
                                                        <option value="es" {{ 'selected' if preferences and preferences.language == 'es' else '' }}>Spanish</option>
                                                        <option value="fr" {{ 'selected' if preferences and preferences.language == 'fr' else '' }}>French</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>Timezone</label>
                                                    <select class="form-control" id="timezone" name="timezone">
                                                        <option value="UTC" {{ 'selected' if preferences and preferences.timezone == 'UTC' else '' }}>UTC</option>
                                                        <option value="America/New_York" {{ 'selected' if preferences and preferences.timezone == 'America/New_York' else '' }}>Eastern Time</option>
                                                        <option value="America/Chicago" {{ 'selected' if preferences and preferences.timezone == 'America/Chicago' else '' }}>Central Time</option>
                                                        <option value="America/Denver" {{ 'selected' if preferences and preferences.timezone == 'America/Denver' else '' }}>Mountain Time</option>
                                                        <option value="America/Los_Angeles" {{ 'selected' if preferences and preferences.timezone == 'America/Los_Angeles' else '' }}>Pacific Time</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="sidebar_collapsed" name="sidebar_collapsed" {{ 'checked' if preferences and preferences.sidebar_collapsed else '' }}>
                                                        <label class="custom-control-label" for="sidebar_collapsed">Collapsed Sidebar</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="notifications_enabled" name="notifications_enabled" {{ 'checked' if preferences and preferences.notifications_enabled else '' }}>
                                                        <label class="custom-control-label" for="notifications_enabled">Enable Notifications</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <button type="submit" class="btn btn-primary btn-lg btn-block">
                                                Save Preferences
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/app.min.js"></script>
    <script src="assets/js/scripts.js"></script>
    <script>
        document.getElementById('preferencesForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const preferences = {};
            
            // Handle checkbox values
            preferences.sidebar_collapsed = formData.get('sidebar_collapsed') === 'on';
            preferences.notifications_enabled = formData.get('notifications_enabled') === 'on';
            
            // Handle select values
            preferences.theme = formData.get('theme');
            preferences.dashboard_layout = formData.get('dashboard_layout');
            preferences.language = formData.get('language');
            preferences.timezone = formData.get('timezone');
            
            // Send to API
            fetch('/api/preferences', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(preferences)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Preferences saved successfully!');
                    // Apply theme immediately
                    if (preferences.theme) {
                        document.body.setAttribute('data-theme', preferences.theme);
                    }
                } else {
                    alert('Error saving preferences');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error saving preferences');
            });
        });
    </script>
</body>
</html>